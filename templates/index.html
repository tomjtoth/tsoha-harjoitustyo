{% extends "layout.html" %}
{% block title %}Verenluovutus-sovellus{% endblock %}
{% block body %}
<div class="loader">
    <div></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', _ => {

        // temp solution (?)
        // idk how to build the charts with the proper bg color pre-set
        // so I'm changing them here to the desired ones
        for (const bg of document.querySelectorAll(`
            svg.main-svg:first-child, 
            g.legend>rect.bg
        `)) {
            bg.style.background = 'var(--body-bg)';
        }

        for (const rect_bg of document.querySelectorAll('g.legend>rect.bg')) {
            rect_bg.style['fill-opacity'] = '';
            rect_bg.style.fill = '';
        }

        for (const txt of document.querySelectorAll(`
            svg.main-svg text.legendtext,
            svg.main-svg text.ytitle,
            svg.main-svg text.xtitle,
            svg.main-svg text.gtitle,
            g.xtick>text,
            g.ytick>text
        `)) {
            txt.style.fill = 'var(--body)';
        }

        document.querySelector('div.loader').setAttribute('hidden', 'hidden');
    })
</script>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

{% if session.user %}
Tervetuloa, {{ session.user.fnames }}.
<h2>Omat luovutukset</h2>
{% if plots.2 %}
<div class="chart" id="own-donations">
    <script>
        var plot_own = {{ plots.2.0 | safe}};
        var plot_own_conf = {{ plots.2.1 | safe}};
        Plotly.plot('own-donations', plot_own, plot_own_conf);
    </script>
</div>
{% else %}
<p>Et ole viel채 luovuttanut, tervetuloa!</p>
{% endif %}
{% endif %}

<h2>Kaikki luovutukset j채rjestelm채ss채</h2>
<div class="chart" id="all-by-clinic">
    <script>
        var plot_by_clinic = {{ plots.0.0 | safe}};
        var plot_by_clinic_conf = {{ plots.0.1 | safe}};
        Plotly.plot('all-by-clinic', plot_by_clinic, plot_by_clinic_conf);
    </script>
</div>

<div class="chart" id="all-by-blood-type">
    <script>
        var plot_by_type = {{ plots.1.0 | safe}};
        var plot_by_type_conf = {{ plots.1.1 | safe}};
        Plotly.plot('all-by-blood-type', plot_by_type, plot_by_type_conf);
    </script>
</div>

{% endblock %}